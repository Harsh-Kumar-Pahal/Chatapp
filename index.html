<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ConnectSphere</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000;
            --bubble-sent: #007AFF;
            --bubble-received: #2C2C2E;
            --text-color: #FFF;
            --secondary-text: #AEAEB2;
            --input-bg: #1C1C1E;
            --border-color: #2C2C2E;
            --button-bg: #007AFF;
            --button-hover: #0066CC;
            --error-color: #FF453A;
            --search-bg: #1C1C1E;
            --header-bg: #1C1C1E;
            --call-bg: rgba(0, 0, 0, 0.8);
            --control-bg: rgba(60, 60, 67, 0.36);
            --online-color: #34C759; /* Green */
            --offline-color: #FF3B30; /* Red */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
            height: 100%; /* Use 100% instead of 100vh for better mobile handling */
            width: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            position: relative;
        }

        .auth-section, .chat-section, .call-popup {
            background-color: var(--bg-color);
            border-radius: 0;
            transition: all 0.3s ease;
        }

        .auth-section {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 24px;
        }

        input, button {
            width: 100%;
            padding: 12px 16px; /* Increased padding for easier tap */
            margin: 8px 0;
            border: none;
            border-radius: 10px; /* Slightly less rounded */
            font-size: 17px;
            font-weight: 400;
            line-height: 1.4;
            transition: all 0.2s ease;
        }

        input {
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        input::placeholder {
            color: var(--secondary-text);
        }

        input:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3); /* Focus ring */
        }

        button {
            background-color: var(--button-bg);
            color: white;
            font-weight: 500;
            cursor: pointer;
        }

        button:active {
            transform: scale(0.98);
            background-color: var(--button-hover);
        }

        .chat-section {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: var(--bg-color);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px; /* Adjusted padding */
            background-color: var(--header-bg);
            border-bottom: 0.5px solid var(--border-color); /* Thinner border */
            height: 56px; /* Standard iOS header height */
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-title {
            font-weight: 600;
            font-size: 17px;
            text-align: center;
            flex-grow: 1; /* Allow title to center properly */
            margin-left: 10px; /* Space after back button */
        }

        .header-actions {
            display: flex;
            align-items: center; /* Align buttons vertically */
            gap: 0px; /* Reduced gap */
        }

        .header-button {
            background: none;
            border: none;
            color: var(--button-bg); /* Use theme color */
            font-size: 17px;
            font-weight: 400; /* Regular weight for action text */
            padding: 8px; /* Easier tap target */
            margin: 0; /* Remove default margins */
            width: auto;
            cursor: pointer;
            display: flex; /* Align icon and text if needed */
            align-items: center;
            justify-content: center;
            min-width: 44px; /* Ensure minimum tap area */
            min-height: 44px;
        }
         .header-button i, .header-button svg { /* Style icons within buttons */
             font-size: 22px; /* Slightly larger icons */
         }

        .header-button.logout-button { /* Specific style for logout */
            color: var(--error-color);
            font-weight: 400;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 8px 16px;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .chat-item:hover {
            background-color: var(--input-bg);
        }

        .chat-item-avatar { /* Placeholder for future avatar */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--bubble-received); /* Placeholder color */
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 16px;
        }

        .chat-item-info {
            flex: 1;
            overflow: hidden; /* Prevent long text overflow */
        }

        .chat-item-header {
             display: flex;
             align-items: center;
             gap: 6px; /* Space between email and status dot */
             margin-bottom: 2px;
        }

        .chat-item-email {
            font-weight: 500;
            font-size: 17px;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0; /* Prevent dot from shrinking */
        }

        .status-dot.online {
            background-color: var(--online-color);
        }

        .status-dot.offline {
            background-color: var(--offline-color);
        }

        .chat-item-last-message {
            font-size: 15px; /* Slightly smaller */
            color: var(--secondary-text);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        .message-row {
            display: flex;
            margin: 2px 0;
            width: 100%;
            padding: 0 4px; /* Small horizontal padding */
        }

        .message-row.sent {
            justify-content: flex-end;
        }

        .message-row.received {
            justify-content: flex-start;
        }

        .message {
            max-width: 75%; /* Slightly wider max width */
            padding: 8px 12px;
            border-radius: 18px;
            font-size: 17px;
            line-height: 1.4;
            word-wrap: break-word;
            position: relative;
            margin: 2px 0;
            box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13); /* Subtle shadow */
        }

        .sent .message {
            background-color: var(--bubble-sent);
            color: white;
            border-bottom-right-radius: 4px; /* iMessage style adjustment */
        }

        .received .message {
            background-color: var(--bubble-received);
            color: var(--text-color);
            border-bottom-left-radius: 4px; /* iMessage style adjustment */
        }

        .timestamp {
            font-size: 11px;
            color: var(--secondary-text);
            margin-top: 4px; /* More space */
            text-align: right;
            display: block; /* Ensure it takes its own line if needed */
        }

        .input-area {
            padding: 8px 12px 8px 16px; /* Adjusted padding */
            background-color: var(--header-bg);
            border-top: 0.5px solid var(--border-color);
            display: flex;
            align-items: flex-end; /* Align items to bottom */
            gap: 8px;
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10;
            padding-bottom: calc(8px + env(safe-area-inset-bottom)); /* Adjust for safe area */
        }

        #messageInput { /* Use ID for specific styling */
            flex: 1;
            border-radius: 18px;
            padding: 8px 16px;
            min-height: 38px; /* iOS like height */
            max-height: 100px;
            resize: none;
            overflow-y: auto;
            border: none; /* Remove border */
            margin: 0; /* Remove margin */
            font-size: 17px;
        }

        .send-button {
            width: 38px; /* Match input height */
            height: 38px;
            border-radius: 50%;
            background-color: var(--button-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin: 0 0 0 4px; /* Small left margin */
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .send-button i {
            color: white;
            font-size: 18px;
            transform: translateX(1px); /* Fine-tune icon position */
        }
        .send-button:active {
            background-color: var(--button-hover);
            transform: none; /* Disable scale transform for this button */
        }


        .search-container {
            padding: 8px 16px;
            background-color: var(--header-bg);
            border-bottom: 0.5px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .search-input {
            flex: 1;
            border-radius: 10px;
            margin: 0; /* Remove margin */
            padding: 8px 12px; /* Adjust padding */
            height: 36px;
        }

        .search-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            padding: 0;
            background-color: transparent;
            color: var(--button-bg);
            margin: 0; /* Remove margin */
            display: flex;
            align-items: center;
            justify-content: center;
        }
         .search-button i {
             font-size: 18px;
         }

        #searchResult {
            display: none;
            font-size: 15px;
            color: var(--secondary-text);
            text-align: center;
            padding: 12px 16px; /* Add padding */
            background-color: var(--header-bg); /* Match background */
            border-bottom: 0.5px solid var(--border-color); /* Add border */
        }

        .error {
            color: var(--error-color);
            font-size: 14px;
            text-align: center;
            margin-top: 12px; /* More space */
            padding: 0 16px; /* Add padding */
        }

        .video-call-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--call-bg);
            z-index: 20;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .video-grid {
            display: flex; /* Use flex for positioning */
            width: 100%;
            height: 100%;
            position: relative; /* Needed for absolute positioning of local video */
        }

        /* Remote video fills the background */
        #remoteVideoContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* Behind local video and controls */
        }
         #remoteVideo {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area */
            background-color: #000; /* Black background if no video */
         }

        /* Local video Picture-in-Picture style */
        #localVideoContainer {
            position: absolute;
            bottom: calc(90px + env(safe-area-inset-bottom)); /* Position above controls */
            right: 16px; /* Padding from edge */
            width: 100px; /* Smaller PiP size */
            height: 150px; /* Adjust aspect ratio */
            border-radius: 12px; /* Rounded corners */
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle border */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Shadow */
            z-index: 3; /* Above remote video */
            background-color: #1c1c1e; /* Background if video not loaded */
        }
         #localVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror front camera */
         }

        .controls {
            position: absolute;
            bottom: calc(20px + env(safe-area-inset-bottom)); /* Position accounting for safe area */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            background-color: var(--control-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 12px 20px; /* More horizontal padding */
            border-radius: 24px;
            z-index: 3; /* Above videos */
        }

        .control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(120, 120, 128, 0.36);
            color: #fff; /* Ensure icon color is white by default */
            border: none; /* Remove border */
            margin: 0; /* Remove margin */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .control-button i {
             font-size: 20px; /* Adjust icon size */
         }

        .control-button:hover {
            background-color: rgba(120, 120, 128, 0.5);
        }
        .control-button:active {
            transform: scale(0.95); /* Add active state */
        }

        #hangupButton { /* Special style for hangup */
            background-color: #ff3b30; /* Red background */
        }
        #hangupButton:hover {
            background-color: #db2c22; /* Darker red on hover */
        }
        #hangupButton i {
            color: #fff; /* White icon */
            transform: rotate(135deg); /* Correct orientation */
        }

        /* Style for muted/video off states */
        .control-button.active-state {
            background-color: #fff; /* White background when active (like iOS) */
        }
         .control-button.active-state i {
             color: #000; /* Black icon when active */
         }


        .call-popup {
            display: none; /* Hidden by default */
            width: 270px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(58, 58, 60, 0.85); /* Dark, slightly transparent */
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            z-index: 30; /* Above everything */
        }

        .call-popup p {
            font-size: 17px;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 24px; /* More space before buttons */
        }

        .call-popup .button-row {
            display: flex;
            justify-content: space-around; /* Space out buttons */
            gap: 10px;
        }

        .call-popup button {
            border-radius: 10px;
            margin: 0; /* Remove margin */
            flex: 1; /* Make buttons share space */
            padding: 10px; /* Adjust padding */
            font-weight: 500;
        }

        .accept-button { /* Style accept button */
            background-color: var(--online-color); /* Green */
        }
        .reject-button {
            background-color: var(--error-color); /* Red */
        }
        .accept-button:active {
            background-color: #2aa14a;
        }
        .reject-button:active {
             background-color: #d63027;
         }

        @media (max-width: 600px) {
            .message {
                max-width: 80%;
            }

            .controls {
                gap: 12px;
                padding: 10px 15px;
            }

            .control-button {
                width: 46px; /* Slightly smaller on mobile */
                height: 46px;
            }
             .control-button i {
                 font-size: 18px;
             }

            #localVideoContainer {
                width: 90px;
                height: 135px;
                right: 10px;
                bottom: calc(80px + env(safe-area-inset-bottom));
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .message-row {
            animation: fadeIn 0.2s ease-out;
        }

        .call-popup {
            animation: fadeIn 0.3s ease-out;
        }

        .chat-section {
            display: flex;
            flex-direction: column;
            height: 100%; /* Ensures chat section fills its container */
            background-color: var(--bg-color);
            /* The children will now use flexbox to determine height */
        }

        .header {
            /* ... (keep existing styles) */
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        .search-container {
             /* ... (keep existing styles) */
            flex-shrink: 0; /* Prevent search from shrinking */
        }

        .messages {
            flex: 1; /* Takes up all available vertical space */
            overflow-y: auto; /* Allows scrolling *within* this element */
            padding: 8px 16px;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
            /* No height: 100% needed here, flex: 1 handles it */
        }

        .chat-list {
             flex: 1; /* Takes up all available vertical space */
             overflow-y: auto; /* Allows scrolling *within* this element */
             background-color: var(--bg-color);
             display: flex;
             flex-direction: column;
             scroll-behavior: smooth;
             /* No height: 100% needed here, flex: 1 handles it */
        }


        .input-area {
            padding: 8px 12px 8px 16px; /* Adjusted padding */
            background-color: var(--header-bg);
            border-top: 0.5px solid var(--border-color);
            display: flex;
            align-items: flex-end; /* Align items to bottom */
            gap: 8px;
            /* REMOVED: position: sticky; */
            /* REMOVED: bottom: 0; */
            /* REMOVED: left: 0; */
            /* REMOVED: right: 0; */
            /* REMOVED: z-index: 10; */
            flex-shrink: 0; /* Prevent input area from shrinking */
            padding-bottom: calc(8px + env(safe-area-inset-bottom)); /* Keep safe area padding */
        }

        /* Ensure html/body still manage overall height */
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
            height: 100%; /* Correct for this layout */
            width: 100%;
            overflow: hidden; /* Prevent body scroll */
            background-color: var(--bg-color);
            color: var(--text-color);
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Ensure container takes full height */
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            /* Padding removed here, handled by sections or safe area as needed */
            position: relative; /* Keep for absolutely positioned children like call popup */
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <h1 style="text-align: center; margin-bottom: 24px; font-weight: 600;">Messages</h1>
            <input type="email" id="email" placeholder="Email" required autocomplete="email">
            <input type="password" id="password" placeholder="Password" required autocomplete="current-password">
            <button onclick="signup()">Sign Up</button>
            <button onclick="login()">Log In</button>
            <div id="authStatus" class="error"></div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section" id="chatSection" style="display: none;">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="header-button" style="display: none;" id="backButton" onclick="goBackToChatList()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="header-title" id="chatTitle">Messages</div>
                <div class="header-actions">
                     <button class="header-button" id="videoCallButton" onclick="startVideoCall()" style="display: none;"> <!-- Hidden initially -->
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="header-button logout-button" onclick="logout()">
                        Logout
                    </button>
                </div>
            </div>

            <!-- Search Area -->
            <div class="search-container" id="searchContainer">
                <input type="email" id="searchInput" placeholder="Search by email" class="search-input">
                <button class="search-button" onclick="searchUser()"><i class="fas fa-search"></i></button>
            </div>
            <div id="searchResult"></div>

            <!-- Chat List -->
            <div class="chat-list" id="chatList">
                <!-- Chat list items will be loaded here -->
                <div style="padding: 20px; text-align: center; color: var(--secondary-text);">Loading chats...</div>
            </div>

            <!-- Messages Area -->
            <div class="messages" id="messages" style="display: none;"></div>

            <!-- Input Area -->
            <div class="input-area" id="inputArea" style="display: none;">
                <input type="text" id="messageInput" placeholder="Message" class="message-input"></input> <!-- Changed to input for simplicity, adjust if textarea needed -->
                <button class="send-button" type="button" onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
            </div>
        </div>

        <!-- Video Call Overlay -->
        <div id="videoCallContainer" class="video-call-container">
            <div class="video-grid">
                <div id="remoteVideoContainer">
                    <video id="remoteVideo" autoplay playsinline></video>
                </div>
                <div id="localVideoContainer">
                    <video id="localVideo" autoplay playsinline muted></video>
                </div>
            </div>
            <div id="controls" class="controls">
                <button class="control-button" id="muteButton" title="Mute Audio"><i class="fa-solid fa-microphone fa-lg"></i></button>
                <button class="control-button" id="videoButton" title="Stop Video"><i class="fa-solid fa-video fa-lg"></i></button>
                <button class="control-button" title="Flip Camera" onclick="switchCamera()"><i class="fa-solid fa-rotate fa-lg"></i></button> <!-- Changed icon -->
                <button class="control-button" id="hangupButton" title="End Call"><i class="fa-solid fa-phone fa-lg"></i></button>
            </div>
        </div>

        <!-- Incoming Call Popup -->
        <div id="callPopup" class="call-popup">
            <p id="callMessage">Incoming Call...</p>
            <div class="button-row">
                <button class="reject-button" onclick="rejectCall()">Decline</button>
                <button class="accept-button" onclick="joinVideoCall()">Accept</button>
            </div>
        </div>
    </div>

    <script>
        
const _0x3becb0=_0x490c;(function(_0xf4616c,_0x55673a){const _0x5371ac=_0x490c,_0x155fc5=_0xf4616c();while(!![]){try{const _0x5b7e4f=-parseInt(_0x5371ac(0x2ed))/0x1*(parseInt(_0x5371ac(0x220))/0x2)+-parseInt(_0x5371ac(0x256))/0x3+-parseInt(_0x5371ac(0x2c0))/0x4*(-parseInt(_0x5371ac(0x26c))/0x5)+parseInt(_0x5371ac(0x289))/0x6*(parseInt(_0x5371ac(0x29b))/0x7)+-parseInt(_0x5371ac(0x31d))/0x8+-parseInt(_0x5371ac(0x21f))/0x9*(parseInt(_0x5371ac(0x24a))/0xa)+parseInt(_0x5371ac(0x1fa))/0xb*(parseInt(_0x5371ac(0x2ff))/0xc);if(_0x5b7e4f===_0x55673a)break;else _0x155fc5['push'](_0x155fc5['shift']());}catch(_0x5e1f8a){_0x155fc5['push'](_0x155fc5['shift']());}}}(_0x2966,0xd9920));const _0x546d40=_0x126b;(function(_0x33d2df,_0x5c72ba){const _0x5990a2=_0x490c,_0x121c4b=_0x126b,_0x472168=_0x33d2df();while(!![]){try{const _0x23d475=parseInt(_0x121c4b(0x1a8))/0x1+-parseInt(_0x121c4b(0x251))/0x2+parseInt(_0x121c4b(0x24d))/0x3*(-parseInt(_0x121c4b(0x22d))/0x4)+-parseInt(_0x121c4b(0x282))/0x5*(-parseInt(_0x121c4b(0x22a))/0x6)+parseInt(_0x121c4b(0x26d))/0x7+parseInt(_0x121c4b(0x1a9))/0x8*(parseInt(_0x121c4b(0x2c5))/0x9)+-parseInt(_0x121c4b(0x1d7))/0xa*(-parseInt(_0x121c4b(0x208))/0xb);if(_0x23d475===_0x5c72ba)break;else _0x472168[_0x5990a2(0x2ee)](_0x472168[_0x5990a2(0x2b7)]());}catch(_0x1c4e83){_0x472168['push'](_0x472168[_0x5990a2(0x2b7)]());}}}(_0x2d85,0x65f57));const firebaseConfig={'apiKey':_0x546d40(0x25a),'authDomain':'fir-c0c18.firebaseapp.com','databaseURL':_0x546d40(0x1a5),'projectId':_0x546d40(0x216),'storageBucket':_0x546d40(0x2a6),'messagingSenderId':'11840063593','appId':_0x546d40(0x2c2)};firebase[_0x546d40(0x2bf)](firebaseConfig);const auth=firebase[_0x546d40(0x235)](),db=firebase[_0x546d40(0x273)]();let currentUser=null,chatPartner=null,currentChatId=null,isChatListLoading=![],presenceRef=null,userStatusListener=null,chatListStatusListeners={};const configuration={'iceServers':[{'urls':_0x546d40(0x23c)},{'urls':_0x3becb0(0x2cd)},{'urls':_0x546d40(0x2b5)}]};let peerConnection=null,localStream=null,remoteStream=null,incomingCallId=null,incomingCallData=null,outgoingCallId=null,callListeners={},isAudioMuted=![],isVideoOff=![],currentFacingMode=_0x546d40(0x22c),pendingIceCandidates=[];const authSection=document[_0x546d40(0x1e4)](_0x546d40(0x1be)),chatSection=document[_0x546d40(0x1e4)](_0x546d40(0x23a)),authStatus=document[_0x546d40(0x1e4)](_0x3becb0(0x28c)),emailInput=document[_0x546d40(0x1e4)]('email'),passwordInput=document[_0x546d40(0x1e4)](_0x3becb0(0x282)),backButton=document[_0x546d40(0x1e4)](_0x546d40(0x2c7)),chatTitle=document[_0x546d40(0x1e4)](_0x546d40(0x2c1)),searchContainer=document[_0x546d40(0x1e4)]('searchContainer'),searchInput=document[_0x546d40(0x1e4)](_0x546d40(0x1a3)),searchResult=document[_0x546d40(0x1e4)](_0x546d40(0x1dc)),chatListDiv=document[_0x546d40(0x1e4)](_0x546d40(0x1a4)),messagesDiv=document['getElementById'](_0x3becb0(0x2d2)),inputArea=document[_0x546d40(0x1e4)](_0x546d40(0x1f0)),messageInput=document[_0x546d40(0x1e4)](_0x3becb0(0x238)),videoCallButton=document[_0x3becb0(0x28a)](_0x546d40(0x1db)),videoCallContainer=document[_0x546d40(0x1e4)](_0x546d40(0x1c8)),localVideo=document[_0x546d40(0x1e4)](_0x546d40(0x1c5)),remoteVideo=document[_0x3becb0(0x28a)](_0x546d40(0x1a1)),callPopup=document[_0x3becb0(0x28a)](_0x3becb0(0x2ad)),callMessage=document[_0x546d40(0x1e4)](_0x546d40(0x1e2)),muteButton=document[_0x546d40(0x1e4)](_0x546d40(0x240)),videoButton=document[_0x546d40(0x1e4)](_0x3becb0(0x30f)),hangupButton=document[_0x546d40(0x1e4)](_0x546d40(0x1e1));auth[_0x546d40(0x1d4)](_0x178aae=>{const _0x5ea3f8=_0x3becb0,_0x413e96=_0x546d40;if(_0x178aae)console[_0x413e96(0x250)](_0x413e96(0x252),_0x178aae[_0x413e96(0x1a6)],_0x178aae[_0x413e96(0x229)]),currentUser={'uid':_0x178aae[_0x413e96(0x1a6)],'email':_0x178aae[_0x413e96(0x229)]},authSection[_0x413e96(0x1d3)][_0x413e96(0x259)]='none',chatSection[_0x413e96(0x1d3)][_0x413e96(0x259)]=_0x413e96(0x193),authStatus[_0x413e96(0x2bc)]='',saveUserToDatabase(_0x178aae),setupPresenceSystem(),listenForIncomingCalls(),goBackToChatList();else{console[_0x413e96(0x250)](_0x413e96(0x293)),presenceRef&&(presenceRef[_0x413e96(0x206)]({'online':![],'last_seen':firebase[_0x413e96(0x273)][_0x5ea3f8(0x304)][_0x413e96(0x22e)]}),presenceRef[_0x413e96(0x1f1)]()[_0x413e96(0x1bd)]());if(userStatusListener)db[_0x413e96(0x26f)](_0x413e96(0x263))[_0x413e96(0x2b1)](_0x413e96(0x1bf),userStatusListener);currentUser=null,chatPartner=null,currentChatId=null,authSection[_0x413e96(0x1d3)][_0x413e96(0x259)]=_0x413e96(0x193),chatSection[_0x413e96(0x1d3)][_0x413e96(0x259)]=_0x413e96(0x22f),messagesDiv[_0x413e96(0x1ef)]='',chatListDiv[_0x413e96(0x1ef)]='',searchResult[_0x413e96(0x2bc)]='',searchResult[_0x413e96(0x1d3)][_0x413e96(0x259)]=_0x5ea3f8(0x219),chatTitle[_0x413e96(0x2bc)]=_0x413e96(0x203),messagesDiv['style'][_0x413e96(0x259)]=_0x413e96(0x22f),inputArea[_0x413e96(0x1d3)][_0x413e96(0x259)]=_0x413e96(0x22f),backButton[_0x413e96(0x1d3)][_0x5ea3f8(0x2f8)]=_0x5ea3f8(0x219),searchContainer[_0x5ea3f8(0x306)][_0x413e96(0x259)]=_0x413e96(0x193),videoCallButton[_0x5ea3f8(0x306)][_0x413e96(0x259)]=_0x413e96(0x22f),cleanupCall(_0x413e96(0x293)),clearChatListStatusListeners(),db[_0x413e96(0x26f)](_0x413e96(0x1e9))[_0x413e96(0x2b1)]();}});function signup(){const _0x26649e=_0x3becb0,_0x91ca8a=_0x546d40,_0x332d2b=emailInput[_0x26649e(0x25d)],_0x27b266=passwordInput[_0x91ca8a(0x1bf)];authStatus[_0x91ca8a(0x2bc)]='',auth[_0x91ca8a(0x25b)](_0x332d2b,_0x27b266)[_0x91ca8a(0x275)](()=>console[_0x91ca8a(0x250)]('Signup\x20successful'))[_0x26649e(0x2c4)](_0x3df570=>{const _0x3baa6b=_0x26649e,_0x36bd93=_0x91ca8a;console[_0x3baa6b(0x261)](_0x36bd93(0x1c9),_0x3df570),authStatus[_0x36bd93(0x2bc)]=_0x3df570['message'];});}function login(){const _0x12e35a=_0x3becb0,_0x29d975=_0x546d40,_0x321bb2=emailInput[_0x12e35a(0x25d)],_0x91b7ef=passwordInput[_0x29d975(0x1bf)];authStatus[_0x12e35a(0x307)]='',auth[_0x29d975(0x207)](_0x321bb2,_0x91b7ef)[_0x29d975(0x275)](()=>console[_0x29d975(0x250)](_0x12e35a(0x29a)))[_0x12e35a(0x2c4)](_0x2f94d4=>{const _0x58fc46=_0x12e35a,_0x9e594c=_0x29d975;console[_0x9e594c(0x217)](_0x9e594c(0x2a8),_0x2f94d4),authStatus[_0x9e594c(0x2bc)]=_0x2f94d4[_0x58fc46(0x2b6)];});}function logout(){const _0x2b62eb=_0x546d40;cleanupCall(_0x2b62eb(0x27f)),auth['signOut']()[_0x2b62eb(0x291)](_0x3fb354=>{const _0x1e227d=_0x490c,_0x216225=_0x2b62eb;console[_0x216225(0x217)](_0x216225(0x27c),_0x3fb354),authStatus[_0x216225(0x2bc)]=_0x216225(0x26e)+_0x3fb354[_0x1e227d(0x2b6)];});}function saveUserToDatabase(_0x2c6a34){const _0x1b9d5f=_0x546d40,_0x3eb0a7=db[_0x1b9d5f(0x26f)](_0x1b9d5f(0x1f7)+_0x2c6a34[_0x1b9d5f(0x1a6)]);_0x3eb0a7[_0x1b9d5f(0x1df)]({'email':_0x2c6a34[_0x1b9d5f(0x229)],'uid':_0x2c6a34[_0x1b9d5f(0x1a6)]});}function setupPresenceSystem(){const _0x530166=_0x3becb0,_0x5ada16=_0x546d40;if(!currentUser)return;const _0x4e8fbe=db[_0x5ada16(0x26f)](_0x5ada16(0x263));presenceRef=db[_0x5ada16(0x26f)](_0x530166(0x2e6)+currentUser[_0x5ada16(0x1a6)]),userStatusListener=_0x4e8fbe['on'](_0x530166(0x25d),_0x2fef15=>{const _0x8f9d25=_0x530166,_0xc5b55c=_0x5ada16;_0x2fef15[_0xc5b55c(0x2a4)]()===!![]?(presenceRef[_0xc5b55c(0x206)]({'online':!![],'last_seen':firebase[_0x8f9d25(0x225)][_0xc5b55c(0x27d)]['TIMESTAMP']}),presenceRef[_0xc5b55c(0x1f1)]()[_0xc5b55c(0x206)]({'online':![],'last_seen':firebase[_0xc5b55c(0x273)][_0xc5b55c(0x27d)][_0xc5b55c(0x22e)]}),console[_0x8f9d25(0x320)](_0xc5b55c(0x27a),currentUser[_0x8f9d25(0x27c)])):console[_0xc5b55c(0x250)](_0xc5b55c(0x197),currentUser[_0xc5b55c(0x1a6)]);});}function clearChatListStatusListeners(){const _0x3d9fed=_0x546d40;Object[_0x3d9fed(0x257)](chatListStatusListeners)['forEach'](_0x4fa8ee=>{const _0x241984=_0x3d9fed;_0x4fa8ee[_0x241984(0x26f)]&&_0x4fa8ee['callback']&&_0x4fa8ee[_0x241984(0x26f)][_0x241984(0x2b1)](_0x241984(0x1bf),_0x4fa8ee[_0x241984(0x232)]);}),chatListStatusListeners={};}async function searchUser(){const _0x14d374=_0x3becb0,_0x33e3a9=_0x546d40,_0x21725d=searchInput[_0x33e3a9(0x1bf)][_0x33e3a9(0x294)]();searchResult[_0x33e3a9(0x1d3)][_0x33e3a9(0x259)]=_0x33e3a9(0x2b9),searchResult[_0x33e3a9(0x2bc)]=_0x33e3a9(0x283);if(!_0x21725d||!currentUser){searchResult[_0x33e3a9(0x2bc)]=_0x33e3a9(0x243);return;}if(_0x21725d===currentUser[_0x33e3a9(0x229)]){searchResult[_0x14d374(0x307)]=_0x14d374(0x23e);return;}try{const _0x224100=await db[_0x33e3a9(0x26f)]('users')[_0x33e3a9(0x2a3)](_0x33e3a9(0x229))[_0x33e3a9(0x21d)](_0x21725d)[_0x33e3a9(0x213)](_0x33e3a9(0x1bf));if(_0x224100[_0x33e3a9(0x29f)]()){const _0x53f968=_0x224100[_0x33e3a9(0x2a4)](),_0x22c58a=Object[_0x33e3a9(0x225)](_0x53f968)[0x0],_0x553326=_0x53f968[_0x22c58a][_0x14d374(0x2ea)];chatPartner={'uid':_0x22c58a,'email':_0x553326},currentChatId=[currentUser[_0x33e3a9(0x1a6)],chatPartner[_0x33e3a9(0x1a6)]][_0x33e3a9(0x1ae)]()[_0x33e3a9(0x221)]('_'),searchResult[_0x33e3a9(0x2bc)]=_0x33e3a9(0x29d)+chatPartner[_0x33e3a9(0x229)]+_0x33e3a9(0x2cb),searchInput[_0x33e3a9(0x1bf)]='',setTimeout(()=>{const _0x2cefe0=_0x33e3a9;searchResult[_0x2cefe0(0x1d3)][_0x2cefe0(0x259)]=_0x2cefe0(0x22f),loadMessages(currentChatId);},0x3e8);}else searchResult[_0x33e3a9(0x2bc)]=_0x33e3a9(0x28f),chatPartner=null,currentChatId=null;}catch(_0x5c6686){console[_0x33e3a9(0x217)](_0x14d374(0x253),_0x5c6686),searchResult[_0x14d374(0x307)]=_0x14d374(0x302);}}function sendMessage(){const _0x28aa91=_0x3becb0,_0x203636=_0x546d40,_0x2d23f6=messageInput[_0x203636(0x1bf)][_0x28aa91(0x2bb)]();if(!_0x2d23f6||!chatPartner||!currentChatId||!currentUser)return;const _0xab9d06={'senderUid':currentUser[_0x203636(0x1a6)],'message':_0x2d23f6,'timestamp':firebase[_0x28aa91(0x225)][_0x28aa91(0x304)][_0x203636(0x22e)]},_0x4d2a8e=db[_0x203636(0x26f)](_0x203636(0x1d0)+currentChatId+_0x203636(0x265)),_0x4e0ec2=db[_0x203636(0x26f)](_0x203636(0x1d0)+currentChatId+_0x203636(0x19e));_0x4d2a8e[_0x28aa91(0x2ee)](_0xab9d06)[_0x28aa91(0x203)](()=>{const _0x22ca2e=_0x28aa91,_0x5c6f9f=_0x203636;return _0x4e0ec2[_0x5c6f9f(0x1df)]({'lastTimestamp':firebase[_0x5c6f9f(0x273)][_0x5c6f9f(0x27d)][_0x5c6f9f(0x22e)],'lastMessage':_0x2d23f6,'participants':{[currentUser[_0x5c6f9f(0x1a6)]]:!![],[chatPartner[_0x22ca2e(0x27c)]]:!![]}});})[_0x203636(0x275)](()=>{const _0x32cf99=_0x28aa91,_0x3a2967=_0x203636;messageInput[_0x3a2967(0x1bf)]='',messageInput[_0x32cf99(0x306)][_0x3a2967(0x261)]=_0x3a2967(0x24a);})[_0x203636(0x291)](_0x477803=>{const _0x550b19=_0x203636;console[_0x550b19(0x217)](_0x550b19(0x242),_0x477803);});}function loadMessages(_0x519a1a){const _0x4e86b1=_0x3becb0,_0x127a76=_0x546d40;if(!_0x519a1a||!currentUser)return;currentChatId&&currentChatId!==_0x519a1a&&(db[_0x127a76(0x26f)](_0x127a76(0x1d0)+currentChatId+_0x127a76(0x265))[_0x127a76(0x2b1)](),console[_0x127a76(0x250)](_0x127a76(0x246)+currentChatId)),(messagesDiv[_0x127a76(0x1ef)]='',currentChatId=_0x519a1a,console[_0x127a76(0x250)](_0x127a76(0x218)+currentChatId));const _0x46c10f=currentChatId[_0x127a76(0x1f6)]('_'),_0x4d3153=_0x46c10f[_0x127a76(0x1aa)](_0x1d588b=>_0x1d588b!==currentUser[_0x127a76(0x1a6)]);if(!_0x4d3153){console[_0x127a76(0x217)](_0x127a76(0x21f),currentChatId),goBackToChatList();return;}db[_0x127a76(0x26f)](_0x127a76(0x1f7)+_0x4d3153)[_0x127a76(0x213)](_0x4e86b1(0x25d),_0x1ae821=>{const _0x8b4e8a=_0x4e86b1,_0x34b9a9=_0x127a76;if(_0x1ae821['exists']()){chatPartner={'uid':_0x4d3153,'email':_0x1ae821[_0x34b9a9(0x2a4)]()[_0x8b4e8a(0x2ea)]},chatTitle[_0x34b9a9(0x2bc)]=chatPartner[_0x34b9a9(0x229)][_0x34b9a9(0x1f6)]('@')[0x0],videoCallButton[_0x34b9a9(0x1d3)][_0x34b9a9(0x259)]=_0x8b4e8a(0x2c8);const _0x509e98=db[_0x34b9a9(0x26f)](_0x8b4e8a(0x29e)+currentChatId+_0x8b4e8a(0x322));_0x509e98[_0x34b9a9(0x2a3)](_0x34b9a9(0x2a5))['on'](_0x34b9a9(0x226),_0x2cafe9=>{const _0x9e85b6=_0x8b4e8a,_0x422bf4=_0x34b9a9;if(!_0x2cafe9[_0x422bf4(0x29f)]())return;const _0x512d4e=_0x2cafe9[_0x9e85b6(0x31b)]();renderMessage(_0x512d4e);},_0x304599=>{const _0x337e36=_0x34b9a9;console['error'](_0x337e36(0x192),_0x304599);}),console[_0x34b9a9(0x250)](_0x34b9a9(0x1ee)+currentChatId);}else{console[_0x34b9a9(0x217)](_0x34b9a9(0x19a),currentChatId),goBackToChatList();return;}},_0x1058a9=>{const _0x536fd2=_0x4e86b1,_0x49caab=_0x127a76;console[_0x49caab(0x217)](_0x536fd2(0x303),_0x1058a9),goBackToChatList();}),chatListDiv[_0x4e86b1(0x306)][_0x127a76(0x259)]=_0x4e86b1(0x219),searchContainer[_0x127a76(0x1d3)][_0x127a76(0x259)]=_0x4e86b1(0x219),searchResult[_0x127a76(0x1d3)][_0x127a76(0x259)]=_0x127a76(0x22f),messagesDiv[_0x127a76(0x1d3)][_0x127a76(0x259)]=_0x127a76(0x193),inputArea[_0x127a76(0x1d3)][_0x4e86b1(0x2f8)]=_0x127a76(0x193),backButton[_0x127a76(0x1d3)][_0x127a76(0x259)]=_0x127a76(0x193);}function renderMessage(_0x423a00){const _0x100772=_0x3becb0,_0x5e7efe=_0x546d40;if(!_0x423a00||!currentUser)return;const _0x14dd37=_0x423a00[_0x5e7efe(0x24e)]===currentUser[_0x5e7efe(0x1a6)]?_0x5e7efe(0x1e7):_0x5e7efe(0x1cf),_0xaea505=_0x423a00[_0x5e7efe(0x2a5)]?new Date(_0x423a00[_0x5e7efe(0x2a5)])[_0x5e7efe(0x2a9)](_0x5e7efe(0x1d1),{'hour':_0x100772(0x314),'minute':_0x100772(0x239),'hour12':!![]}):'',_0x3a51a1=document[_0x5e7efe(0x2b2)](_0x100772(0x244));_0x3a51a1[_0x5e7efe(0x205)]=_0x5e7efe(0x1f9)+_0x14dd37;const _0x3cd0e7=(_0x423a00[_0x100772(0x2b6)]||'')[_0x100772(0x266)](/</g,'<')[_0x5e7efe(0x2ad)](/>/g,'>');_0x3a51a1[_0x100772(0x2db)]=_0x5e7efe(0x1ba)+_0x3cd0e7+_0x5e7efe(0x211)+_0xaea505+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',messagesDiv[_0x5e7efe(0x1a2)](_0x3a51a1),messagesDiv[_0x5e7efe(0x2bd)]({'top':messagesDiv[_0x5e7efe(0x24f)],'behavior':_0x5e7efe(0x295)});}async function loadChatList(){const _0x157087=_0x3becb0,_0x3727c2=_0x546d40;if(!currentUser||isChatListLoading)return;isChatListLoading=!![],chatListDiv[_0x3727c2(0x1ef)]=_0x3727c2(0x253),clearChatListStatusListeners(),chatTitle[_0x3727c2(0x2bc)]=_0x3727c2(0x203),backButton[_0x3727c2(0x1d3)][_0x3727c2(0x259)]=_0x3727c2(0x22f),chatListDiv[_0x3727c2(0x1d3)][_0x3727c2(0x259)]=_0x3727c2(0x193),messagesDiv[_0x3727c2(0x1d3)][_0x157087(0x2f8)]=_0x3727c2(0x22f),inputArea[_0x3727c2(0x1d3)][_0x3727c2(0x259)]=_0x3727c2(0x22f),searchContainer[_0x3727c2(0x1d3)][_0x157087(0x2f8)]=_0x3727c2(0x193),videoCallButton[_0x3727c2(0x1d3)][_0x3727c2(0x259)]='none',currentChatId=null,chatPartner=null;try{const _0x53a460=await db[_0x3727c2(0x26f)](_0x3727c2(0x247))[_0x3727c2(0x2a3)](_0x3727c2(0x1d8)+currentUser[_0x3727c2(0x1a6)])[_0x3727c2(0x21d)](!![])[_0x3727c2(0x213)](_0x3727c2(0x1bf)),_0xe9b891=[];_0x53a460[_0x3727c2(0x29f)]()&&_0x53a460[_0x3727c2(0x280)](_0x4ff982=>{const _0x47ae61=_0x157087,_0x416cb5=_0x3727c2,_0x3678c4=_0x4ff982[_0x416cb5(0x24c)],_0x53e529=_0x4ff982[_0x416cb5(0x2a4)]()[_0x416cb5(0x1fb)];if(_0x53e529&&_0x3678c4[_0x416cb5(0x279)]('_')){const _0x586ff4=_0x3678c4[_0x47ae61(0x308)]('_'),_0x102229=_0x586ff4[_0x416cb5(0x1aa)](_0x1619a3=>_0x1619a3!==currentUser[_0x47ae61(0x27c)]);_0x102229&&_0xe9b891[_0x416cb5(0x23b)]({'chatId':_0x3678c4,'partnerUid':_0x102229,'lastMessage':_0x53e529[_0x47ae61(0x2c9)]||'','timestamp':_0x53e529[_0x416cb5(0x20e)]||0x0});}}),(_0xe9b891[_0x3727c2(0x1ae)]((_0xb44124,_0x1edd23)=>_0x1edd23[_0x3727c2(0x2a5)]-_0xb44124[_0x3727c2(0x2a5)]),chatListDiv[_0x3727c2(0x1ef)]='');if(_0xe9b891[_0x3727c2(0x271)]===0x0)chatListDiv[_0x157087(0x2db)]=_0x3727c2(0x2a2);else{const _0x150dae=_0xe9b891[_0x3727c2(0x1ea)](_0x585673=>db[_0x3727c2(0x26f)](_0x3727c2(0x1f7)+_0x585673[_0x3727c2(0x201)])[_0x3727c2(0x213)](_0x3727c2(0x1bf))[_0x3727c2(0x275)](_0x21536a=>({..._0x585673,'partnerData':_0x21536a[_0x157087(0x31b)]()}))[_0x3727c2(0x291)](_0x551965=>{const _0xdf7545=_0x157087,_0x5ad0c3=_0x3727c2;return console[_0x5ad0c3(0x217)](_0x5ad0c3(0x198)+_0x585673[_0xdf7545(0x2df)],_0x551965),{..._0x585673,'partnerData':null};})),_0x300b94=await Promise[_0x157087(0x2f9)](_0x150dae);_0x300b94[_0x3727c2(0x280)](_0xef2269=>{const _0x7afec3=_0x157087,_0x51ca3d=_0x3727c2;if(_0xef2269[_0x51ca3d(0x262)]){const _0x5e2878=_0xef2269[_0x51ca3d(0x262)][_0x7afec3(0x2ea)],_0x19119d=document[_0x7afec3(0x2cc)](_0x51ca3d(0x298));_0x19119d[_0x51ca3d(0x205)]=_0x51ca3d(0x2a1),_0x19119d['setAttribute'](_0x51ca3d(0x1b2),_0xef2269[_0x51ca3d(0x28b)]),_0x19119d[_0x51ca3d(0x25e)](_0x51ca3d(0x20d),_0xef2269[_0x51ca3d(0x201)]);const _0x57ee63=(_0xef2269[_0x51ca3d(0x19f)]||'')[_0x51ca3d(0x2ad)](/</g,'<')[_0x51ca3d(0x2ad)](/>/g,'>');_0x19119d[_0x51ca3d(0x1ef)]=_0x51ca3d(0x277)+(_0x5e2878?_0x5e2878[_0x51ca3d(0x2c8)](0x0)[_0x51ca3d(0x269)]():'?')+_0x51ca3d(0x214)+(_0x5e2878||_0x51ca3d(0x2ba))+_0x51ca3d(0x194)+_0xef2269[_0x51ca3d(0x201)]+_0x51ca3d(0x231)+_0x57ee63+_0x51ca3d(0x202),_0x19119d[_0x51ca3d(0x1ca)](_0x51ca3d(0x278),()=>{const _0x160fc8=_0x51ca3d;chatPartner={'uid':_0xef2269[_0x160fc8(0x201)],'email':_0x5e2878},loadMessages(_0xef2269[_0x160fc8(0x28b)]);}),chatListDiv['appendChild'](_0x19119d),listenForPartnerStatus(_0xef2269[_0x51ca3d(0x201)]);}else console[_0x7afec3(0x2c3)](_0x51ca3d(0x268)+_0xef2269[_0x51ca3d(0x201)]);});}}catch(_0x4d14e7){console['error'](_0x3727c2(0x258),_0x4d14e7),chatListDiv[_0x3727c2(0x1ef)]=_0x157087(0x277);}finally{isChatListLoading=![];}}function listenForPartnerStatus(_0xdc2e){const _0x3fdb6c=_0x546d40;if(!_0xdc2e)return;if(chatListStatusListeners[_0xdc2e])return;console[_0x3fdb6c(0x250)]('Setting\x20up\x20status\x20listener\x20for\x20'+_0xdc2e);const _0x33ae4f=db[_0x3fdb6c(0x26f)](_0x3fdb6c(0x2af)+_0xdc2e),_0xffe593=_0x2bca7d=>{const _0x4c63be=_0x490c,_0x1572c5=_0x3fdb6c,_0x42f9ea=_0x2bca7d[_0x1572c5(0x2a4)](),_0x101415=document['getElementById'](_0x1572c5(0x255)+_0xdc2e);if(_0x101415)_0x42f9ea&&_0x42f9ea['online']===!![]?(_0x101415[_0x1572c5(0x245)][_0x1572c5(0x20c)](_0x1572c5(0x1ec)),_0x101415[_0x1572c5(0x245)][_0x1572c5(0x1dd)](_0x4c63be(0x2ce))):(_0x101415[_0x1572c5(0x245)][_0x1572c5(0x20c)](_0x1572c5(0x239)),_0x101415[_0x4c63be(0x20d)][_0x1572c5(0x1dd)](_0x1572c5(0x1ec)));else{}};_0x33ae4f['on'](_0x3fdb6c(0x1bf),_0xffe593,_0x4a1c20=>{const _0x4697f8=_0x3fdb6c;console[_0x4697f8(0x217)](_0x4697f8(0x237)+_0xdc2e+':',_0x4a1c20),delete chatListStatusListeners[_0xdc2e];}),chatListStatusListeners[_0xdc2e]={'ref':_0x33ae4f,'callback':_0xffe593};}function goBackToChatList(){const _0x39567a=_0x3becb0,_0x307984=_0x546d40;currentChatId&&(db[_0x307984(0x26f)](_0x307984(0x1d0)+currentChatId+_0x39567a(0x322))[_0x307984(0x2b1)](),console[_0x39567a(0x320)](_0x307984(0x246)+currentChatId)),loadChatList();}async function getMediaStream(){const _0x4cc659=_0x3becb0,_0x2ceb9e=_0x546d40;try{const _0x5b0848={'video':{'facingMode':currentFacingMode,'width':{'ideal':0x280},'height':{'ideal':0x1e0}},'audio':{'echoCancellation':!![],'noiseSuppression':!![]}};return localStream=await navigator[_0x2ceb9e(0x1fc)][_0x2ceb9e(0x219)](_0x5b0848),localVideo[_0x2ceb9e(0x21a)]=localStream,localVideo[_0x4cc659(0x306)]['display']=_0x2ceb9e(0x2b9),console[_0x2ceb9e(0x250)](_0x4cc659(0x290)),!![];}catch(_0x19e5eb){return console[_0x2ceb9e(0x217)](_0x2ceb9e(0x1ed),_0x19e5eb),alert(_0x2ceb9e(0x1e6)+_0x19e5eb['message']+'.\x20Please\x20check\x20permissions.'),localVideo[_0x4cc659(0x306)][_0x2ceb9e(0x259)]=_0x2ceb9e(0x22f),![];}}async function startVideoCall(){const _0x176c42=_0x3becb0,_0xa586eb=_0x546d40;if(!chatPartner||!currentUser){alert(_0x176c42(0x2eb));return;}if(peerConnection){alert(_0xa586eb(0x284));return;}console[_0xa586eb(0x250)](_0xa586eb(0x276)+chatPartner[_0xa586eb(0x229)]+'\x20('+chatPartner[_0xa586eb(0x1a6)]+')');if(!await getMediaStream())return;removeCallListeners(),peerConnection=new RTCPeerConnection(configuration),console[_0xa586eb(0x250)](_0xa586eb(0x2b7)),setupPeerConnectionListeners(),localStream[_0x176c42(0x21e)]()[_0xa586eb(0x280)](_0x4df84e=>{const _0x43757c=_0xa586eb;peerConnection[_0x43757c(0x21c)](_0x4df84e,localStream),console[_0x43757c(0x250)](_0x43757c(0x1e5),_0x4df84e[_0x43757c(0x212)]);});const _0xe2341d=db[_0xa586eb(0x26f)](_0x176c42(0x2b4))[_0xa586eb(0x23b)]();outgoingCallId=_0xe2341d[_0x176c42(0x2f7)],console[_0xa586eb(0x250)](_0x176c42(0x269),outgoingCallId);try{const _0x38c83b=await peerConnection[_0x176c42(0x248)]();await peerConnection[_0xa586eb(0x2ab)](_0x38c83b),console[_0xa586eb(0x250)](_0xa586eb(0x25c)),await _0xe2341d[_0xa586eb(0x206)]({'callerUid':currentUser[_0xa586eb(0x1a6)],'callerEmail':currentUser[_0xa586eb(0x229)],'calleeUid':chatPartner[_0xa586eb(0x1a6)],'offer':{'type':_0x38c83b[_0xa586eb(0x272)],'sdp':_0x38c83b[_0xa586eb(0x1de)]},'status':_0xa586eb(0x1ac),'timestamp':firebase[_0xa586eb(0x273)][_0xa586eb(0x27d)][_0x176c42(0x287)]}),console[_0xa586eb(0x250)]('Call\x20document\x20created\x20in\x20Firebase\x20with\x20offer.');const _0x1b4521=db['ref'](_0x176c42(0x1fb)+outgoingCallId+_0x176c42(0x281));callListeners[_0xa586eb(0x1b8)]={'ref':_0x1b4521,'handler':handleAnswer},_0x1b4521['on'](_0xa586eb(0x1bf),handleAnswer,_0x16eb23=>{const _0x2da8e2=_0xa586eb;console[_0x2da8e2(0x217)]('Error\x20listening\x20for\x20answer:',_0x16eb23),cleanupCall(_0x2da8e2(0x20f));}),listenForRemoteCandidates(chatPartner[_0xa586eb(0x1a6)],outgoingCallId),listenForCallStatus(outgoingCallId),showVideoCallUI();}catch(_0x15879c){console[_0xa586eb(0x217)](_0xa586eb(0x290),_0x15879c),cleanupCall(_0xa586eb(0x28a)+_0x15879c[_0xa586eb(0x1b7)]);}}function _0x2d85(){const _0x37c383=_0x3becb0,_0x8ec07d=[_0x37c383(0x2a5),'Firebase\x20configuration\x20is\x20missing\x20the\x20\x27databaseURL\x27.',_0x37c383(0x2e7),'cancel',_0x37c383(0x233),_0x37c383(0x25d),_0x37c383(0x24c),_0x37c383(0x2a0),_0x37c383(0x20b),_0x37c383(0x30d),_0x37c383(0x329),_0x37c383(0x2ec),_0x37c383(0x267),'\x20pending\x20ICE\x20candidates.','videoCallContainer',_0x37c383(0x2be),_0x37c383(0x260),'getTracks',_0x37c383(0x305),'currentRemoteDescription',_0x37c383(0x257),_0x37c383(0x263),'chats/',_0x37c383(0x240),_0x37c383(0x2d7),'style',_0x37c383(0x280),_0x37c383(0x25b),_0x37c383(0x258),_0x37c383(0x2dc),'metadata/participants/','ICE\x20connection\x20closed.',_0x37c383(0x216),'videoCallButton','searchResult',_0x37c383(0x20e),_0x37c383(0x2a2),_0x37c383(0x2c7),_0x37c383(0x2ca),'hangupButton','callMessage','signalingState',_0x37c383(0x28a),_0x37c383(0x26a),_0x37c383(0x26f),_0x37c383(0x31f),_0x37c383(0x2bf),_0x37c383(0x2b4),_0x37c383(0x270),'calleeUid','offline',_0x37c383(0x2fe),_0x37c383(0x2a3),'innerHTML',_0x37c383(0x318),_0x37c383(0x316),'streams','getVideoTracks',_0x37c383(0x2ba),'<i\x20class=\x22fa-solid\x20fa-microphone-slash\x20fa-lg\x22></i>',_0x37c383(0x308),_0x37c383(0x268),_0x37c383(0x2ac),_0x37c383(0x255),_0x37c383(0x27a),_0x37c383(0x227),'mediaDevices',_0x37c383(0x265),_0x37c383(0x311),_0x37c383(0x243),_0x37c383(0x2a1),_0x37c383(0x2df),_0x37c383(0x2d5),_0x37c383(0x2b1),_0x37c383(0x247),_0x37c383(0x2a7),_0x37c383(0x230),'signInWithEmailAndPassword','62249kWnpbY',_0x37c383(0x23b),'toggle',_0x37c383(0x2d1),_0x37c383(0x24e),_0x37c383(0x218),_0x37c383(0x2f2),'Failed\x20to\x20establish\x20connection.',_0x37c383(0x232),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22timestamp\x22>',_0x37c383(0x2b2),'once',_0x37c383(0x22f),_0x37c383(0x294),_0x37c383(0x30a),_0x37c383(0x261),_0x37c383(0x2ae),_0x37c383(0x1f1),_0x37c383(0x2e2),'onsignalingstatechange','addTrack',_0x37c383(0x209),_0x37c383(0x200),'Could\x20not\x20determine\x20partner\x20UID\x20from\x20chat\x20ID:',_0x37c383(0x25e),'join',_0x37c383(0x298),'Removing\x20call\x20listeners...',_0x37c383(0x27b),_0x37c383(0x324),_0x37c383(0x299),_0x37c383(0x259),_0x37c383(0x2fa),_0x37c383(0x2ea),'21426rOefJA',_0x37c383(0x310),'user',_0x37c383(0x2af),_0x37c383(0x287),_0x37c383(0x219),_0x37c383(0x1f5),'\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-item-last-message\x22>','callback',_0x37c383(0x229),_0x37c383(0x2f3),_0x37c383(0x222),'Call\x20became\x20unavailable\x20before\x20joining.',_0x37c383(0x2f0),_0x37c383(0x226),_0x37c383(0x2ce),_0x37c383(0x2e9),_0x37c383(0x2ee),_0x37c383(0x1fd),'warn',_0x37c383(0x313),'ICE\x20Connection\x20State\x20Changed:',_0x37c383(0x2cf),'PeerConnection\x20listeners\x20set\x20up.','Send\x20message\x20error:',_0x37c383(0x236),_0x37c383(0x2a9),_0x37c383(0x20d),_0x37c383(0x1ff),_0x37c383(0x237),_0x37c383(0x2b0),_0x37c383(0x2d6),'38px',_0x37c383(0x207),'key',_0x37c383(0x283),_0x37c383(0x28b),_0x37c383(0x2c1),_0x37c383(0x320),'1588346ZQcLmg',_0x37c383(0x211),_0x37c383(0x245),_0x37c383(0x2ef),_0x37c383(0x2bd),_0x37c383(0x2de),_0x37c383(0x23a),_0x37c383(0x201),_0x37c383(0x2f8),_0x37c383(0x241),_0x37c383(0x278),'Offer\x20created\x20and\x20set\x20as\x20local\x20description.',_0x37c383(0x249),_0x37c383(0x326),_0x37c383(0x2b5),_0x37c383(0x23f),'height',_0x37c383(0x2e1),_0x37c383(0x215),_0x37c383(0x264),_0x37c383(0x322),_0x37c383(0x2b9),_0x37c383(0x1fb),_0x37c383(0x2b3),_0x37c383(0x26b),_0x37c383(0x28d),_0x37c383(0x27d),'Listening\x20for\x20incoming\x20calls\x20for\x20user:',_0x37c383(0x2f5),_0x37c383(0x291),'ref',_0x37c383(0x20a),_0x37c383(0x25a),'type',_0x37c383(0x225),_0x37c383(0x22c),_0x37c383(0x203),_0x37c383(0x284),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-item-avatar\x22>',_0x37c383(0x228),_0x37c383(0x2dd),_0x37c383(0x20f),_0x37c383(0x30e),_0x37c383(0x24b),'ServerValue',_0x37c383(0x328),_0x37c383(0x234),'forEach','Call\x20',_0x37c383(0x31e),_0x37c383(0x24f),_0x37c383(0x2d0),_0x37c383(0x29d),'Failed\x20to\x20process\x20answer.',_0x37c383(0x279),_0x37c383(0x23d),_0x37c383(0x217),_0x37c383(0x319),'chatId',_0x37c383(0x210),'answered',_0x37c383(0x1f6),_0x37c383(0x292),_0x37c383(0x26e),_0x37c383(0x2c4),_0x37c383(0x2b8),_0x37c383(0x25c),'trim',_0x37c383(0x202),'remoteDescription',_0x37c383(0x2c6),'div',_0x37c383(0x223),_0x37c383(0x1f4),_0x37c383(0x2cb),'\x20is\x20no\x20longer\x20available\x20or\x20ringing.','Found\x20',_0x37c383(0x1fc),_0x37c383(0x317),'disconnected',_0x37c383(0x309),_0x37c383(0x312),_0x37c383(0x204),_0x37c383(0x31b),_0x37c383(0x20c),_0x37c383(0x22d),_0x37c383(0x31c),_0x37c383(0x29c),_0x37c383(0x2da),_0x37c383(0x22a),_0x37c383(0x23c),_0x37c383(0x208),_0x37c383(0x266),_0x37c383(0x2e0),_0x37c383(0x2e6),_0x37c383(0x213),_0x37c383(0x286),_0x37c383(0x2cc),_0x37c383(0x2aa),'Answer\x20created\x20and\x20set\x20as\x20local\x20description.',_0x37c383(0x28f),'Invalid\x20state\x20for\x20joining\x20call.','RTCPeerConnection\x20created.','Incoming\x20call\x20detected:\x20',_0x37c383(0x2fb),_0x37c383(0x275),_0x37c383(0x206),_0x37c383(0x307),_0x37c383(0x1f8),_0x37c383(0x2fc),_0x37c383(0x273),_0x37c383(0x1f2),_0x37c383(0x27f),_0x37c383(0x221),_0x37c383(0x2f6),_0x37c383(0x2e3),_0x37c383(0x31a),_0x37c383(0x254),_0x37c383(0x2bc),_0x37c383(0x2d3),_0x37c383(0x2d8),'Peers\x20connected!',_0x37c383(0x246),'onicecandidate',_0x37c383(0x285),_0x37c383(0x2c8),_0x37c383(0x323),_0x37c383(0x22b),_0x37c383(0x231),_0x37c383(0x235),_0x37c383(0x32a),'candidates',_0x37c383(0x22e),_0x37c383(0x26d),_0x37c383(0x2fd),_0x37c383(0x214),_0x37c383(0x2a4),_0x37c383(0x2c9),_0x37c383(0x30c),_0x37c383(0x2d9),_0x37c383(0x224),_0x37c383(0x1fe),_0x37c383(0x276),_0x37c383(0x24d),'uid',_0x37c383(0x288),'325332fjHDVY','72BvDEeX','find','Error\x20updating\x20call\x20status\x20to\x20rejected:',_0x37c383(0x205),_0x37c383(0x2e4),_0x37c383(0x2a6),_0x37c383(0x2d4),'Local\x20media\x20stream\x20stopped.',_0x37c383(0x30b),_0x37c383(0x252),_0x37c383(0x21c),_0x37c383(0x29f),_0x37c383(0x250),_0x37c383(0x274),_0x37c383(0x2b6),'answer',_0x37c383(0x301)];return _0x2d85=function(){return _0x8ec07d;},_0x2d85();}function listenForIncomingCalls(){const _0xf0a30c=_0x3becb0,_0xc1c4cc=_0x546d40;if(!currentUser)return;console[_0xf0a30c(0x320)](_0xc1c4cc(0x26c),currentUser[_0xf0a30c(0x27c)]);const _0x3f10b6=db[_0xf0a30c(0x2c5)](_0xc1c4cc(0x1e9))[_0xc1c4cc(0x2a3)](_0xc1c4cc(0x1eb))[_0xf0a30c(0x209)](currentUser[_0xf0a30c(0x27c)]);_0x3f10b6[_0xc1c4cc(0x2b1)](_0xf0a30c(0x299)),_0x3f10b6['on'](_0xc1c4cc(0x226),async _0x35d9a7=>{const _0x8f3d0c=_0xf0a30c,_0x501513=_0xc1c4cc,_0x3d74e7=_0x35d9a7[_0x501513(0x24c)],_0x43afd8=_0x35d9a7[_0x501513(0x2a4)]();if(!_0x43afd8||_0x43afd8[_0x501513(0x29b)]!==_0x501513(0x1ac)){console[_0x501513(0x250)](_0x501513(0x254)+_0x3d74e7+':\x20Invalid\x20data\x20or\x20status\x20is\x20not\x20\x27ringing\x27\x20('+_0x43afd8?.[_0x501513(0x29b)]+')');return;}if(peerConnection||incomingCallId){console[_0x501513(0x250)](_0x8f3d0c(0x2ef)+_0x3d74e7+':\x20Already\x20in\x20a\x20call\x20or\x20handling\x20another\x20incoming\x20call.');return;}try{const _0x1a9c17=await db[_0x501513(0x26f)](_0x501513(0x267)+_0x3d74e7)[_0x501513(0x213)](_0x501513(0x1bf));if(!_0x1a9c17[_0x501513(0x29f)]()||_0x1a9c17['val']()['status']!==_0x8f3d0c(0x205)){console[_0x8f3d0c(0x320)](_0x501513(0x254)+_0x3d74e7+_0x501513(0x1d6));return;}incomingCallId=_0x3d74e7,incomingCallData=_0x1a9c17[_0x501513(0x2a4)](),console[_0x501513(0x250)](_0x501513(0x2b8)+incomingCallId+_0x501513(0x204)+incomingCallData[_0x501513(0x270)]),callMessage[_0x501513(0x2bc)]=(incomingCallData[_0x501513(0x270)]||_0x8f3d0c(0x21d))+_0x8f3d0c(0x2a8),callPopup[_0x501513(0x1d3)][_0x8f3d0c(0x2f8)]=_0x501513(0x2b9),listenForCallStatus(incomingCallId);}catch(_0x4cf1d2){console[_0x8f3d0c(0x261)]('Error\x20verifying\x20incoming\x20call\x20'+_0x3d74e7+':',_0x4cf1d2);}},_0x2703c8=>{const _0x456ac7=_0xf0a30c,_0x519b1c=_0xc1c4cc;console[_0x456ac7(0x261)](_0x519b1c(0x299),_0x2703c8);});}async function joinVideoCall(){const _0x22cf4f=_0x3becb0,_0x3d5b8e=_0x546d40;if(!incomingCallId||!incomingCallData||peerConnection){alert('No\x20valid\x20incoming\x20call\x20to\x20join\x20or\x20already\x20in\x20a\x20call.'),console[_0x3d5b8e(0x217)](_0x22cf4f(0x296),{'incomingCallId':incomingCallId,'incomingCallData':!!incomingCallData,'peerConnection':!!peerConnection}),hideCallPopup(),cleanupCall(_0x3d5b8e(0x2b6));return;}console[_0x22cf4f(0x320)](_0x3d5b8e(0x196),incomingCallId);const _0x6d9c5b=incomingCallId,_0x43d801=incomingCallData,_0x213ee4=_0x43d801[_0x3d5b8e(0x24b)],_0x3b6084=_0x43d801[_0x3d5b8e(0x21e)];hideCallPopup();try{const _0x181ee5=await db[_0x3d5b8e(0x26f)]('calls/'+_0x6d9c5b)[_0x22cf4f(0x1f3)](_0x3d5b8e(0x1bf));if(!_0x181ee5[_0x3d5b8e(0x29f)]()||_0x181ee5[_0x3d5b8e(0x2a4)]()[_0x3d5b8e(0x29b)]!==_0x3d5b8e(0x1ac)){console[_0x3d5b8e(0x23d)]('Call\x20'+_0x6d9c5b+_0x3d5b8e(0x29c)),alert(_0x3d5b8e(0x28e)),cleanupCall(_0x3d5b8e(0x236));return;}}catch(_0x48248d){console[_0x3d5b8e(0x217)](_0x3d5b8e(0x274)+_0x6d9c5b+_0x3d5b8e(0x287),_0x48248d),cleanupCall(_0x3d5b8e(0x1b4));return;}if(!await getMediaStream()){cleanupCall(_0x3d5b8e(0x1ce));return;}removeCallListeners();if(!_0x213ee4||!_0x3b6084){console[_0x22cf4f(0x261)](_0x3d5b8e(0x200),_0x43d801),cleanupCall(_0x3d5b8e(0x2aa));return;}try{peerConnection=new RTCPeerConnection(configuration),console[_0x3d5b8e(0x250)](_0x3d5b8e(0x1b3)),setupPeerConnectionListeners(),localStream[_0x3d5b8e(0x1cb)]()[_0x3d5b8e(0x280)](_0x227dc9=>{const _0x2bdc82=_0x3d5b8e;peerConnection[_0x2bdc82(0x21c)](_0x227dc9,localStream),console[_0x2bdc82(0x250)](_0x2bdc82(0x1e5),_0x227dc9[_0x2bdc82(0x212)]);}),await peerConnection['setRemoteDescription'](new RTCSessionDescription(_0x3b6084)),console[_0x3d5b8e(0x250)](_0x3d5b8e(0x26b)),await applyPendingIceCandidates();const _0x558467=await peerConnection[_0x3d5b8e(0x289)]();await peerConnection[_0x3d5b8e(0x2ab)](_0x558467),console[_0x3d5b8e(0x250)](_0x3d5b8e(0x2b4)),await db[_0x3d5b8e(0x26f)](_0x3d5b8e(0x267)+_0x6d9c5b)[_0x3d5b8e(0x1df)]({'answer':{'type':_0x558467[_0x3d5b8e(0x272)],'sdp':_0x558467[_0x3d5b8e(0x1de)]},'status':_0x3d5b8e(0x28d)}),console[_0x22cf4f(0x320)](_0x3d5b8e(0x285)),listenForRemoteCandidates(_0x213ee4,_0x6d9c5b),listenForCallStatus(_0x6d9c5b),showVideoCallUI();}catch(_0x2d1391){console[_0x3d5b8e(0x217)](_0x22cf4f(0x212),_0x2d1391),cleanupCall('Failed\x20to\x20join\x20call:\x20'+_0x2d1391[_0x22cf4f(0x2b6)]),alert(_0x3d5b8e(0x1c0)+_0x2d1391[_0x3d5b8e(0x1b7)]),db[_0x3d5b8e(0x26f)](_0x3d5b8e(0x267)+_0x6d9c5b)[_0x3d5b8e(0x1df)]({'status':_0x22cf4f(0x2f6)})[_0x22cf4f(0x2c4)](()=>{});}}function rejectCall(){const _0x4a1f40=_0x3becb0,_0x282b76=_0x546d40,_0x5c9344=incomingCallId;_0x5c9344?(console[_0x4a1f40(0x320)](_0x282b76(0x233),_0x5c9344),db[_0x282b76(0x26f)](_0x282b76(0x267)+_0x5c9344)[_0x282b76(0x1df)]({'status':_0x282b76(0x2c0)})[_0x282b76(0x291)](_0x1cb925=>console[_0x282b76(0x217)](_0x282b76(0x1ab),_0x1cb925))[_0x282b76(0x29a)](()=>{const _0x592b31=_0x282b76;hideCallPopup(),cleanupCall(_0x592b31(0x1c2));})):(console['warn']('Reject\x20called\x20but\x20no\x20incomingCallId\x20was\x20set.'),hideCallPopup(),cleanupCall(_0x282b76(0x1fa)));}function setupPeerConnectionListeners(){const _0x51258b=_0x546d40;if(!peerConnection)return;peerConnection[_0x51258b(0x2cc)]=_0x3d528c=>{const _0x1a7bc9=_0x490c,_0x3d1636=_0x51258b;if(_0x3d528c[_0x3d1636(0x227)]){const _0x2f53bf=outgoingCallId||incomingCallId;_0x2f53bf&&currentUser&&db[_0x3d1636(0x26f)](_0x3d1636(0x267)+_0x2f53bf+_0x3d1636(0x1f8)+currentUser[_0x3d1636(0x1a6)])[_0x3d1636(0x23b)](_0x3d528c[_0x3d1636(0x227)][_0x3d1636(0x256)]())[_0x3d1636(0x291)](_0x406bda=>console[_0x3d1636(0x217)](_0x1a7bc9(0x2f4),_0x406bda));}},remoteStream=new MediaStream(),remoteVideo[_0x51258b(0x21a)]=remoteStream,peerConnection[_0x51258b(0x28c)]=_0xc588a2=>{const _0xa18a5d=_0x490c,_0x2bc0b7=_0x51258b;console[_0x2bc0b7(0x250)](_0x2bc0b7(0x266),_0xc588a2[_0xa18a5d(0x2e4)][_0x2bc0b7(0x212)]),_0xc588a2[_0x2bc0b7(0x1f2)][0x0][_0x2bc0b7(0x1cb)]()[_0x2bc0b7(0x280)](_0x7ec6c0=>{const _0x20ba20=_0xa18a5d,_0x42bb0f=_0x2bc0b7;console[_0x20ba20(0x320)](_0x42bb0f(0x1e0),_0x7ec6c0[_0x42bb0f(0x212)]),remoteStream[_0x20ba20(0x297)](_0x7ec6c0);}),remoteVideo[_0x2bc0b7(0x1d3)][_0xa18a5d(0x2f8)]=_0xa18a5d(0x2fb);},peerConnection[_0x51258b(0x2ac)]=()=>{const _0xf3645c=_0x490c,_0x346b40=_0x51258b,_0x36ff33=peerConnection?peerConnection[_0x346b40(0x23e)]:_0x346b40(0x1c6);console[_0x346b40(0x250)](_0x346b40(0x23f),_0x36ff33);switch(_0x36ff33){case _0x346b40(0x2c6):console[_0x346b40(0x250)](_0x346b40(0x2ca));break;case _0x346b40(0x2a0):console[_0x346b40(0x23d)](_0xf3645c(0x300));break;case _0xf3645c(0x262):console[_0x346b40(0x217)](_0x346b40(0x224)),cleanupCall(_0x346b40(0x224));break;case _0xf3645c(0x267):console[_0xf3645c(0x320)](_0x346b40(0x1d9));break;}},peerConnection[_0x51258b(0x21b)]=()=>{const _0x528ec6=_0x490c,_0x5c008c=_0x51258b;if(peerConnection)console[_0x5c008c(0x250)](_0x528ec6(0x293),peerConnection[_0x5c008c(0x1e3)]);},peerConnection[_0x51258b(0x1b1)]=_0x511a5d=>console[_0x51258b(0x217)](_0x51258b(0x215),_0x511a5d),console[_0x51258b(0x250)](_0x51258b(0x241));}function listenForRemoteCandidates(_0x4d2211,_0x1bfd83){const _0x54e520=_0x3becb0,_0x38f643=_0x546d40;if(!_0x4d2211||!_0x1bfd83)return;console[_0x54e520(0x320)](_0x54e520(0x27e)+_0x4d2211+_0x38f643(0x25f)+_0x1bfd83);const _0x7b7281=db[_0x38f643(0x26f)](_0x38f643(0x267)+_0x1bfd83+_0x38f643(0x1f8)+_0x4d2211),_0x3b9e60=_0x30ffd1=>handleRemoteCandidate(_0x30ffd1);callListeners[_0x38f643(0x199)]=callListeners[_0x38f643(0x199)]||{},callListeners[_0x38f643(0x199)][_0x4d2211]={'ref':_0x7b7281,'handler':_0x3b9e60},_0x7b7281['on'](_0x38f643(0x226),_0x3b9e60,_0x521146=>{const _0x719d07=_0x54e520,_0x157dfe=_0x38f643;console[_0x157dfe(0x217)](_0x157dfe(0x1a7)+_0x4d2211+':',_0x521146),cleanupCall(_0x719d07(0x25f));});}function _0x126b(_0x146cc0,_0x26989d){const _0x493287=_0x2d85();return _0x126b=function(_0x2838b7,_0x3631de){_0x2838b7=_0x2838b7-0x192;let _0x1f0526=_0x493287[_0x2838b7];return _0x1f0526;},_0x126b(_0x146cc0,_0x26989d);}function listenForCallStatus(_0x280afa){const _0xa49a55=_0x3becb0,_0x16e3fe=_0x546d40;if(!_0x280afa)return;console[_0x16e3fe(0x250)](_0x16e3fe(0x2bb)+_0x280afa);const _0x5911f0=db[_0x16e3fe(0x26f)](_0x16e3fe(0x267)+_0x280afa+_0x16e3fe(0x1c1)),_0x3c6486=_0x179829=>{const _0x490ceb=_0x490c,_0xcdfd0a=_0x16e3fe;if(!_0x179829[_0xcdfd0a(0x29f)]()){console[_0xcdfd0a(0x250)](_0xcdfd0a(0x281)+_0x280afa+_0xcdfd0a(0x2b3)),cleanupCall('Call\x20document\x20removed.');return;}const _0x4d5ccb=_0x179829[_0xcdfd0a(0x2a4)]();console[_0xcdfd0a(0x250)](_0xcdfd0a(0x281)+_0x280afa+_0xcdfd0a(0x195)+_0x4d5ccb);if([_0x490ceb(0x1f2),_0xcdfd0a(0x2be),_0xcdfd0a(0x1b5),_0xcdfd0a(0x2c3),_0xcdfd0a(0x1d5)][_0xcdfd0a(0x279)](_0x4d5ccb)){const _0x41d892='Call\x20status\x20became\x20'+_0x4d5ccb;_0x280afa===incomingCallId&&callPopup[_0xcdfd0a(0x1d3)]['display']===_0x490ceb(0x2fb)&&hideCallPopup(),cleanupCall(_0x41d892);}};callListeners[_0x16e3fe(0x29b)]={'ref':_0x5911f0,'handler':_0x3c6486},_0x5911f0['on'](_0xa49a55(0x25d),_0x3c6486,_0x3a763a=>{const _0x460c97=_0x16e3fe;console[_0x460c97(0x217)](_0x460c97(0x1af)+_0x280afa+':',_0x3a763a),cleanupCall('Error\x20monitoring\x20call\x20status.');});}function removeCallListeners(){const _0x32e604=_0x3becb0,_0x4fab68=_0x546d40;console[_0x4fab68(0x250)](_0x4fab68(0x223)),callListeners[_0x4fab68(0x1b8)]&&(callListeners[_0x4fab68(0x1b8)][_0x4fab68(0x26f)][_0x32e604(0x286)](_0x4fab68(0x1bf),callListeners[_0x4fab68(0x1b8)][_0x4fab68(0x19c)]),console[_0x4fab68(0x250)](_0x4fab68(0x234))),callListeners[_0x4fab68(0x199)]&&Object[_0x32e604(0x2ab)](callListeners[_0x4fab68(0x199)])[_0x32e604(0x295)](([_0x2aa9e8,_0x4c69ed])=>{const _0x290272=_0x4fab68;_0x4c69ed[_0x290272(0x26f)][_0x290272(0x2b1)](_0x290272(0x226),_0x4c69ed[_0x290272(0x19c)]),console[_0x290272(0x250)](_0x290272(0x26a)+_0x2aa9e8+'.');}),callListeners[_0x4fab68(0x29b)]&&(callListeners[_0x4fab68(0x29b)][_0x4fab68(0x26f)][_0x4fab68(0x2b1)](_0x4fab68(0x1bf),callListeners[_0x4fab68(0x29b)][_0x4fab68(0x19c)]),console[_0x4fab68(0x250)](_0x4fab68(0x1c3))),callListeners={};}function _0x490c(_0x2f7e13,_0x55ed07){const _0x2966b5=_0x2966();return _0x490c=function(_0x490cc1,_0x1c79a4){_0x490cc1=_0x490cc1-0x1f1;let _0x40a856=_0x2966b5[_0x490cc1];return _0x40a856;},_0x490c(_0x2f7e13,_0x55ed07);}function handleRemoteCandidate(_0x2a9995){const _0x5b43c5=_0x3becb0,_0x172e88=_0x546d40;if(_0x2a9995[_0x172e88(0x29f)]()&&peerConnection)try{const _0x2e45a4=new RTCIceCandidate(_0x2a9995[_0x172e88(0x2a4)]());peerConnection[_0x172e88(0x296)]?peerConnection[_0x172e88(0x2c4)](_0x2e45a4)[_0x172e88(0x291)](_0x1b19f0=>console[_0x172e88(0x217)](_0x172e88(0x1fd),_0x1b19f0)):(pendingIceCandidates[_0x172e88(0x23b)](_0x2e45a4),console[_0x172e88(0x250)](_0x172e88(0x2c9)));}catch(_0x444343){console[_0x172e88(0x217)](_0x5b43c5(0x2f1),_0x444343,_0x2a9995['val']());}}async function handleAnswer(_0x52146a){const _0x208855=_0x546d40,_0xb53048=_0x52146a[_0x208855(0x2a4)]();if(_0xb53048&&peerConnection&&!peerConnection[_0x208855(0x1cd)]){console[_0x208855(0x250)](_0x208855(0x1da));try{await peerConnection[_0x208855(0x238)](new RTCSessionDescription(_0xb53048)),console[_0x208855(0x250)]('Remote\x20description\x20(answer)\x20set.'),await applyPendingIceCandidates();}catch(_0x498363){console['error'](_0x208855(0x22b),_0x498363),cleanupCall(_0x208855(0x286));}}}async function applyPendingIceCandidates(){const _0x3b1910=_0x3becb0,_0x2ac71b=_0x546d40;if(!peerConnection||!peerConnection[_0x2ac71b(0x296)]){console[_0x2ac71b(0x23d)](_0x3b1910(0x242));return;}if(pendingIceCandidates[_0x2ac71b(0x271)]>0x0){console['log'](_0x2ac71b(0x27b)+pendingIceCandidates['length']+_0x2ac71b(0x1c7));const _0x3bb3b1=pendingIceCandidates[_0x3b1910(0x2e8)]();pendingIceCandidates=[];for(const _0x3d4c75 of _0x3bb3b1){try{await peerConnection[_0x2ac71b(0x2c4)](_0x3d4c75);}catch(_0x57fbe2){console[_0x2ac71b(0x217)]('Error\x20applying\x20pending\x20ICE\x20candidate:',_0x57fbe2);}}console[_0x2ac71b(0x250)](_0x2ac71b(0x209));}}async function switchCamera(){const _0x2f7637=_0x3becb0,_0x25452a=_0x546d40;if(!localStream||!peerConnection)return;const _0x1b6900=localStream[_0x25452a(0x1f3)]()[0x0];if(!_0x1b6900)return;_0x1b6900[_0x25452a(0x1ff)]();try{currentFacingMode=currentFacingMode==='user'?_0x25452a(0x297):_0x25452a(0x22c);const _0x4505ad={'video':{'facingMode':currentFacingMode,'width':{'ideal':0x280},'height':{'ideal':0x1e0}}},_0x5cb92d=await navigator['mediaDevices'][_0x25452a(0x219)](_0x4505ad),_0x236d08=_0x5cb92d[_0x25452a(0x1f3)]()[0x0],_0x11b486=peerConnection[_0x25452a(0x260)]()[_0x2f7637(0x327)](_0x516f34=>_0x516f34[_0x25452a(0x1ad)]?.[_0x25452a(0x212)]===_0x2f7637(0x2c2));_0x11b486?(await _0x11b486[_0x25452a(0x2a7)](_0x236d08),console[_0x25452a(0x250)](_0x25452a(0x20b))):console[_0x2f7637(0x2c3)](_0x25452a(0x228)),(localStream[_0x2f7637(0x1f7)](_0x1b6900),localStream[_0x25452a(0x21c)](_0x236d08),localVideo[_0x25452a(0x21a)]=null,localVideo[_0x25452a(0x21a)]=localStream,console[_0x2f7637(0x320)](_0x25452a(0x230)));if(isVideoOff)_0x236d08[_0x25452a(0x25d)]=![];}catch(_0x182013){console[_0x2f7637(0x261)](_0x2f7637(0x325),_0x182013),alert(_0x25452a(0x2ae)+_0x182013[_0x25452a(0x1b7)]);}}function toggleAudio(){const _0x257cb6=_0x3becb0,_0x3f9b46=_0x546d40;if(!localStream)return;const _0x3a3211=localStream[_0x257cb6(0x321)]();_0x3a3211[_0x3f9b46(0x271)]>0x0&&(isAudioMuted=!isAudioMuted,_0x3a3211[_0x3f9b46(0x280)](_0x2f97f5=>_0x2f97f5[_0x3f9b46(0x25d)]=!isAudioMuted),muteButton[_0x3f9b46(0x1ef)]=isAudioMuted?_0x3f9b46(0x1f5):'<i\x20class=\x22fa-solid\x20fa-microphone\x20fa-lg\x22></i>',muteButton[_0x3f9b46(0x245)][_0x3f9b46(0x20a)](_0x3f9b46(0x288),isAudioMuted),console[_0x3f9b46(0x250)](_0x3f9b46(0x1a0)+(isAudioMuted?_0x3f9b46(0x1d2):_0x3f9b46(0x244))));}function toggleVideo(){const _0x14bdff=_0x3becb0,_0x58298a=_0x546d40;if(!localStream)return;const _0x45f5ae=localStream[_0x58298a(0x1f3)]();_0x45f5ae[_0x58298a(0x271)]>0x0&&(isVideoOff=!isVideoOff,_0x45f5ae[_0x14bdff(0x295)](_0x21f062=>_0x21f062[_0x58298a(0x25d)]=!isVideoOff),videoButton[_0x58298a(0x1ef)]=isVideoOff?_0x58298a(0x210):_0x58298a(0x19b),videoButton[_0x58298a(0x245)][_0x58298a(0x20a)](_0x14bdff(0x23d),isVideoOff),console[_0x58298a(0x250)](_0x58298a(0x1b9)+(isVideoOff?_0x58298a(0x2b1):'on')));}function cleanupCall(_0x2d7971=_0x546d40(0x1cc)){const _0x55100b=_0x3becb0,_0x333beb=_0x546d40;console[_0x333beb(0x250)](_0x333beb(0x249)+_0x2d7971),removeCallListeners(),peerConnection&&(peerConnection[_0x333beb(0x2cc)]=null,peerConnection[_0x333beb(0x28c)]=null,peerConnection[_0x333beb(0x2ac)]=null,peerConnection[_0x333beb(0x21b)]=null,peerConnection[_0x55100b(0x30b)]=null,peerConnection[_0x55100b(0x271)]!==_0x55100b(0x267)&&(peerConnection[_0x333beb(0x1bc)](),console[_0x333beb(0x250)](_0x333beb(0x29e))),peerConnection=null),localStream&&(localStream[_0x333beb(0x1cb)]()[_0x333beb(0x280)](_0xff4536=>_0xff4536[_0x333beb(0x1ff)]()),localStream=null,localVideo[_0x333beb(0x21a)]=null,console[_0x55100b(0x320)](_0x333beb(0x1b0))),remoteStream&&(remoteStream[_0x333beb(0x1cb)]()[_0x333beb(0x280)](_0x2096d6=>_0x2096d6[_0x333beb(0x1ff)]()),remoteStream=null,remoteVideo[_0x333beb(0x21a)]=null,console[_0x333beb(0x250)](_0x333beb(0x1f4)));const _0x324a5e=outgoingCallId||incomingCallId;_0x324a5e&&db[_0x55100b(0x2c5)](_0x333beb(0x267)+_0x324a5e+_0x333beb(0x1c1))[_0x333beb(0x213)](_0x333beb(0x1bf),_0x1b4544=>{const _0x454233=_0x55100b,_0x19eb95=_0x333beb;_0x1b4544[_0x19eb95(0x29f)]()&&![_0x19eb95(0x2be),_0x454233(0x1f2),_0x19eb95(0x1b5),_0x19eb95(0x2c3),_0x19eb95(0x1d5)][_0x19eb95(0x279)](_0x1b4544[_0x19eb95(0x2a4)]())&&db[_0x19eb95(0x26f)](_0x19eb95(0x267)+_0x324a5e)[_0x19eb95(0x1df)]({'status':_0x19eb95(0x2be)})[_0x454233(0x2c4)](_0x2f100b=>console[_0x19eb95(0x23d)](_0x454233(0x251),_0x2f100b));}),outgoingCallId=null,incomingCallId=null,incomingCallData=null,pendingIceCandidates=[],isAudioMuted=![],isVideoOff=![],videoCallContainer[_0x333beb(0x1d3)][_0x55100b(0x2f8)]=_0x333beb(0x22f),hideCallPopup(),muteButton[_0x333beb(0x1ef)]=_0x333beb(0x222),videoButton[_0x333beb(0x1ef)]=_0x333beb(0x19b),muteButton[_0x55100b(0x20d)][_0x333beb(0x20c)](_0x55100b(0x23d)),videoButton[_0x55100b(0x20d)][_0x333beb(0x20c)]('active-state'),console[_0x333beb(0x250)](_0x55100b(0x272));}function _0x2966(){const _0x30d2fc=['Error\x20searching\x20user.','Error\x20fetching\x20partner\x20details:','ServerValue','Call\x20ended\x20normally','style','textContent','split','chat-item','fir-c0c18','onicecandidateerror','Audio\x20','\x20-\x20Status\x20listener\x20removed.','Applying\x20','videoButton','Error\x20setting\x20remote\x20description\x20(answer):','shiftKey','<div\x20style=\x22padding:\x2016px;\x20text-align:\x20center;\x20color:\x20var(--secondary-text);\x22>No\x20chats\x20yet.\x20Search\x20for\x20a\x20user\x20to\x20start\x20chatting.</div>','iceConnectionState','numeric','\x20-\x20Status\x20listener\x20removed\x20for\x20ignored\x20incoming\x20call\x20','onDisconnect','exists','inputArea','Call\x20setup\x20failed:\x20','157779sEdUQH','val','replaceTrack','4834952RJcBUG','10aEKSWe','sent','log','getAudioTracks','/messages','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22status-dot\x20offline\x22\x20id=\x22status-','keys','Error\x20switching\x20camera:','setAttribute','find','min','preventDefault','Failed\x20to\x20fetch\x20partner\x20data\x20for\x20','getUserMedia','rejected','once','finally','Local\x20video\x20updated\x20with\x20new\x20camera\x20track.','This\x20call\x20is\x20no\x20longer\x20available.','removeTrack','scrollTo','Enter','39226jmBZFg','calls/','PeerConnection\x20closed.','stun:stun.l.google.com:19302','searchInput','Stopped\x20listening\x20to\x20messages\x20for\x20','offer','Error\x20loading\x20chat\x20list:','smooth','then','orderByChild','ringing','Listening\x20for\x20status\x20changes\x20for\x20call\x20','callerUid','oniceconnectionstatechange','equalTo','callerEmail','Call\x20rejected\x20by\x20user','timestamp','classList','add','Presence\x20set\x20to\x20online\x20for','ontrack','User\x20logged\x20in:','Error\x20joining\x20call:','keypress','WebRTC\x20is\x20not\x20supported\x20by\x20your\x20browser.\x20Video\x20calls\x20will\x20not\x20work.','.info/connected','Received\x20answer.','createAnswer','data-partner-uid','none','Incoming\x20call\x20popup\x20hidden.','parent','RTCPeerConnection\x20created\x20for\x20joining\x20call.','Someone','getTracks','74223IzoSZE','2LEOAjY','1:11840063593:web:73ac480ff6c200b7dfbaf8','auth','Error\x20listening\x20for\x20incoming\x20calls:','appendChild','database','setRemoteDescription','metadata','click','Rejecting\x20call:','Invalid\x20call\x20data\x20for\x20joining.','\x20status\x20changed\x20to:\x20','Error\x20re-verifying\x20call\x20','fir-c0c18.firebasestorage.app','Partner\x20data\x20not\x20found\x20for\x20chat:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-item-email\x22>','set','Attempting\x20to\x20join\x20call:','<i\x20class=\x22fa-solid\x20fa-video-slash\x20fa-lg\x22></i>','authSection','User\x20clicked\x20logout','Presence\x20detected\x20disconnected\x20for','Please\x20enter\x20an\x20email.','chats','messageInput','2-digit','values','Finished\x20applying\x20pending\x20candidates.','setLocalDescription','active-state','You\x20can\x27t\x20chat\x20with\x20yourself!','getSenders','en-US','AIzaSyCQGE1Z_ikaZVjajxRS9TdHq23_ic7W5q4','Cannot\x20apply\x20pending\x20candidates:\x20PeerConnection\x20or\x20remote\x20description\x20not\x20ready.','stop','div','<div\x20style=\x22padding:\x2020px;\x20text-align:\x20center;\x20color:\x20var(--secondary-text);\x22>Loading\x20chats...</div>','.\x20Starting\x20chat...','\x20from\x20','createOffer','enabled','590AgARkC','Logout\x20error:','Failed\x20to\x20join\x20call:\x20','https://fir-c0c18-default-rtdb.firebaseio.com','remove','Searching...','cancelled','Could\x20not\x20update\x20call\x20status\x20to\x20ended:','data-chat-id','Search\x20error:','connected','message-row\x20','2600511JrVuHk','Failed\x20to\x20get\x20media\x20for\x20joining\x20call.',':\x20Call\x20cancelled\x20or\x20status\x20changed\x20before\x20popup\x20shown.','candidate','length','failed_media','User\x20logged\x20out','value','beforeunload','Failed\x20to\x20exchange\x20connection\x20details.','addEventListener','error','failed','received','Firebase\x20configuration\x20is\x20missing\x20the\x20\x27databaseURL\x27.\x20Realtime\x20Database\x20features\x20(chat,\x20calls,\x20presence)\x20will\x20not\x20work.','Error\x20adding\x20received\x20ICE\x20candidate:','replace','closed','users/','Generated\x20outgoing\x20call\x20ID:','Local\x20track\x20added:','toUpperCase','380RsceNq','<i\x20class=\x22fa-solid\x20fa-video\x20fa-lg\x22></i>','Error\x20during\x20call\x20setup\x20(caller):','Could\x20not\x20access\x20camera/microphone:\x20','map','signalingState','Call\x20cleanup\x20complete.','initializeApp','RTCPeerConnection','Unknown\x20User','chatList','<div\x20style=\x22padding:\x2016px;\x20text-align:\x20center;\x20color:\x20var(--error-color);\x22>Failed\x20to\x20load\x20chats.\x20Please\x20try\x20again\x20later.</div>','createUserWithEmailAndPassword','\x20before\x20joining:','Reject\x20called\x20without\x20active\x20incoming\x20call','ICE\x20connection\x20failed.','uid','Remote\x20description\x20(offer)\x20set.','Listening\x20for\x20candidates\x20from\x20','chatTitle','onAuthStateChanged','/answer','password','4854kkyAhf','Attempting\x20to\x20call\x20','Load\x20messages\x20error:','off','TIMESTAMP','Error\x20listening\x20for\x20remote\x20candidates\x20from\x20','48yXWHVI','getElementById','senderUid','authStatus','\x20-\x20Candidates\x20listener\x20removed\x20for\x20','Page\x20closed','stun:stun2.l.google.com:19302','Local\x20media\x20stream\x20obtained.','Logout\x20failed:\x20','User\x20not\x20found.','Signaling\x20State\x20Changed:','ICE\x20Candidate\x20Error:','forEach','Join\x20attempt\x20failed:\x20No\x20valid\x20call\x20ID\x20or\x20data,\x20or\x20already\x20in\x20call.','addTrack','<i\x20class=\x22fa-solid\x20fa-microphone\x20fa-lg\x22></i>','child_added','Login\x20successful','145243ZgVecO','Login\x20error:','Answer\x20sent\x20to\x20Firebase\x20and\x20status\x20updated.','chats/','Failed\x20to\x20verify\x20call\x20before\x20joining.','/status','Invalid\x20call\x20data\x20received:','sdp','Started\x20listening\x20to\x20messages\x20for\x20','/metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sort','className','\x20is\x20calling...','unmuted','\x20was\x20removed.','entries','/candidates/','callPopup','Loading\x20messages\x20for\x20chat:\x20','1660nntKWC','input','Messages','kind','Skipping\x20chat\x20item\x20for\x20missing\x20partner:\x20','calls','\x20for\x20call\x20','message','shift','databaseURL','Remote\x20track\x20received:','Remote\x20media\x20stream\x20stopped.','trim','backButton','status-','Signup\x20error:','Video\x20call\x20UI\x20displayed.','80732NLHvvA','scrollHeight','video','warn','catch','ref','environment','update','flex','lastMessage','Adding\x20track\x20to\x20remote\x20stream:','status','createElement','stun:stun1.l.google.com:19302','online','muteButton','Cannot\x20start\x20call:\x20Already\x20in\x20a\x20call.','Camera\x20track\x20replaced\x20in\x20PeerConnection.','messages','charAt','Error\x20listening\x20to\x20call\x20status\x20for\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Cleaning\x20up\x20call\x20resources.\x20Reason:\x20','muted','Queued\x20remote\x20ICE\x20candidate.','remoteVideo','toLocaleTimeString','innerHTML','1660lqWDXR','includes','toJSON','partnerUid','Failed\x20to\x20switch\x20camera:\x20','partnerData','srcObject','addIceCandidate','track','User\x20hung\x20up','status/','close','slice','chatSection','email','Cannot\x20start\x20call:\x20No\x20chat\x20partner\x20selected.','localVideo','986987DwBUOP','push','Ignoring\x20call\x20','Error\x20listening\x20to\x20status\x20for\x20','Error\x20processing\x20received\x20ICE\x20candidate:','lastTimestamp','\x20-\x20Answer\x20listener\x20removed.','Error\x20sending\x20ICE\x20candidate:','3175333IMYmdV','failed_join','key','display','all','Could\x20not\x20find\x20video\x20sender\x20to\x20replace\x20track.','block','ended','handler','Error\x20accessing\x20media\x20devices:','7188XenPio','Peers\x20disconnected.','Video\x20'];_0x2966=function(){return _0x30d2fc;};return _0x2966();}function showVideoCallUI(){const _0x4a6d11=_0x3becb0,_0x4bdbce=_0x546d40;videoCallContainer[_0x4bdbce(0x1d3)][_0x4bdbce(0x259)]=_0x4a6d11(0x2fb),isAudioMuted=![],isVideoOff=![],muteButton[_0x4bdbce(0x1ef)]=_0x4a6d11(0x298),videoButton[_0x4bdbce(0x1ef)]=_0x4bdbce(0x19b),muteButton[_0x4a6d11(0x20d)][_0x4bdbce(0x20c)](_0x4a6d11(0x23d)),videoButton[_0x4bdbce(0x245)][_0x4bdbce(0x20c)](_0x4bdbce(0x288)),console[_0x4a6d11(0x320)](_0x4bdbce(0x1e8));}function hideCallPopup(){const _0x578ecf=_0x3becb0,_0x51b4e1=_0x546d40;callPopup[_0x51b4e1(0x1d3)][_0x51b4e1(0x259)]!==_0x51b4e1(0x22f)&&(callPopup[_0x51b4e1(0x1d3)][_0x51b4e1(0x259)]=_0x51b4e1(0x22f),callListeners[_0x51b4e1(0x29b)]&&incomingCallId&&callListeners[_0x578ecf(0x2cb)]?.[_0x51b4e1(0x26f)]?.[_0x578ecf(0x21b)]?.[_0x578ecf(0x2f7)]===incomingCallId&&(callListeners['status'][_0x51b4e1(0x26f)][_0x51b4e1(0x2b1)](_0x51b4e1(0x1bf),callListeners[_0x51b4e1(0x29b)][_0x51b4e1(0x19c)]),delete callListeners[_0x51b4e1(0x29b)],console[_0x51b4e1(0x250)](_0x578ecf(0x315)+incomingCallId+'.')),incomingCallId=null,incomingCallData=null,console[_0x51b4e1(0x250)](_0x578ecf(0x21a)));}hangupButton[_0x3becb0(0x260)](_0x546d40(0x278),()=>cleanupCall(_0x3becb0(0x2e5))),muteButton[_0x546d40(0x1ca)](_0x3becb0(0x228),toggleAudio),videoButton[_0x546d40(0x1ca)](_0x546d40(0x278),toggleVideo),messageInput[_0x546d40(0x1ca)](_0x546d40(0x2b0),function(_0x369e83){const _0xec952a=_0x3becb0,_0x4af5cb=_0x546d40;_0x369e83[_0x4af5cb(0x24c)]===_0xec952a(0x1f9)&&!_0x369e83[_0x4af5cb(0x1fe)]&&(_0x369e83[_0x4af5cb(0x1c4)](),sendMessage());}),messageInput[_0x3becb0(0x260)](_0x546d40(0x248),()=>{const _0x45a1be=_0x3becb0,_0x1c1f89=_0x546d40;messageInput[_0x1c1f89(0x1d3)][_0x1c1f89(0x261)]='auto',messageInput[_0x45a1be(0x306)][_0x1c1f89(0x261)]=Math[_0x1c1f89(0x27e)](messageInput[_0x1c1f89(0x24f)],0x64)+'px';}),window[_0x546d40(0x1ca)](_0x546d40(0x220),()=>{const _0x4b1f39=_0x3becb0,_0x40cb5e=_0x546d40;presenceRef&&presenceRef[_0x4b1f39(0x230)]({'online':![],'last_seen':firebase[_0x4b1f39(0x225)][_0x40cb5e(0x27d)][_0x40cb5e(0x22e)]}),cleanupCall(_0x4b1f39(0x28e));}),(!navigator[_0x546d40(0x1fc)]||!navigator[_0x546d40(0x1fc)]['getUserMedia']||!window[_0x546d40(0x1b6)])&&(alert(_0x546d40(0x19d)),videoCallButton[_0x546d40(0x1d3)][_0x546d40(0x259)]=_0x546d40(0x22f)),!firebaseConfig[_0x546d40(0x292)]&&(alert(_0x546d40(0x264)),console[_0x3becb0(0x261)](_0x546d40(0x1bb)));
    </script>
</body>
</html>
